graph TD
    A["🧑 User Query<br/>Natural Language"] --> B["🧠 GraphRAG Engine<br/>Template-Based"]
    
    B --> C["🎯 Intent Classification<br/>Keyword Detection"]
    
    C --> D{Query Category}
    
    D -->|Portfolio Analysis| E["📊 Portfolio Templates<br/>Platform/Region/Count queries"]
    D -->|Geographic| F["🌍 Geographic Templates<br/>State/City/Location filters"]  
    D -->|Economic Data| G["📈 Economic Templates<br/>FRED data HEAD/TAIL chains"]
    D -->|Semantic Search| H["🌱 Vector Search + Templates<br/>ESG, sustainability keywords"]
    D -->|Trend Analysis| I["📉 Trend Templates<br/>Historical comparisons"]
    D -->|General| J["🔧 General Templates<br/>Fallback patterns"]
    
    E --> K["⚙️ Template Selection<br/>Pre-built Cypher patterns"]
    F --> K
    G --> K
    J --> K
    
    H --> L["🔍 Vector Search<br/>OpenAI Embeddings"]
    H --> M["🔧 Semantic Templates<br/>Property description search"]
    I --> N["📊 Economic Templates<br/>START/END comparisons"]
    
    K --> O["🗄️ Neo4j Database<br/>Knowledge Graph"]
    L --> O
    M --> O
    N --> O
    
    O --> P["📋 Response Formatting<br/>Clean tables & text"]
    
    P --> Q["✅ Formatted Answer<br/>Portfolio tables, Asset lists, Economic data"]
    
    style A fill:#e1f5fe
    style B fill:#f3e5f5
    style C fill:#fff3e0
    style D fill:#e8f5e8
    style E fill:#fce4ec
    style F fill:#e0f2f1
    style G fill:#fff8e1
    style H fill:#f1f8e9
    style I fill:#fce4ec
    style J fill:#e3f2fd
    style K fill:#fff3e0
    style L fill:#e8f5e8
    style M fill:#f1f8e9
    style N fill:#fff8e1
    style O fill:#e1f5fe
    style P fill:#f3e5f5
    style Q fill:#e8f5e8